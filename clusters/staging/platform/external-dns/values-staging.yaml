apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: external-dns
  namespace: external-dns
spec:
  values:
    # ðŸ”’ Label WI sur le POD (obligatoire pour lâ€™injection du jeton)
    podLabels:
      azure.workload.identity/use: "true"

    # ðŸ”§ Monte le Secret Ã  /etc/kubernetes pour le fichier azure.json
    extraVolumes:
      - name: azure-config-file
        secret:
          secretName: external-dns-azure
    extraVolumeMounts:
      - name: azure-config-file
        mountPath: /etc/kubernetes
        readOnly: true

    # (optionnel mais explicite) prÃ©cise le chemin si tu veux :
    extraArgs:
      - --azure-config-file=/etc/kubernetes/azure.json
      # - --domain-filter=<example.com>
      # - --azure-use-private-dns

    provider:
      name: azure
    sources:
      - ingress

    registry: txt
    policy: sync
    txtOwnerId: "demo-aks-private"
