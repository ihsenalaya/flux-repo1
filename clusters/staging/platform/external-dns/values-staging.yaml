apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: external-dns
  namespace: external-dns
spec:
  values:
    # Label requis sur le POD pour le webhook WI
    podLabels:
      azure.workload.identity/use: "true"

    # Monter le Secret qui contient azure.json à l'emplacement attendu
    extraVolumes:
      - name: azure-config-file
        secret:
          secretName: external-dns-azure
    extraVolumeMounts:
      - name: azure-config-file
        mountPath: /etc/kubernetes
        readOnly: true

    # Sources et stratégie
    sources: ["ingress"]
    registry: txt
    policy: sync
    txtOwnerId: "aks-staging-01"

    # (Optionnel) restreindre à un domaine ou gérer Private DNS
    # extraArgs:
    #   - --domain-filter=example.com
    #   - --azure-use-private-dns
    #   - --azure-config-file=/etc/kubernetes/azure.json  # explicite si tu veux
